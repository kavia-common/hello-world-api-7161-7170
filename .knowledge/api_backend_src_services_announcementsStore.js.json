{"is_source_file": true, "format": "JavaScript", "description": "This file implements a service module for managing 'announcement' records within a Node.js application. It provides functions for creating, listing, retrieving, updating (full or partial), and deleting announcements, interacting with a MongoDB backend via Mongoose models. The module includes validation logic, normalization for API responses, and error handling specific to MongoDB constraints.", "external_files": ["../db/models/Announcement", "../db/mongoErrors"], "external_methods": ["Announcement.create", "Announcement.find", "Announcement.findOne", "Announcement.findOneAndUpdate", "Announcement.deleteOne", "Announcement.deleteMany", "mapMongoError"], "published": ["createAnnouncement", "listAnnouncements", "getAnnouncementById", "replaceAnnouncement", "patchAnnouncement", "deleteAnnouncement", "clearAll", "ALLOWED_PRIORITIES"], "classes": [], "methods": [{"name": "normalizeForApi(announcement)", "description": "Converts announcement objects into a normalized format suitable for API responses, formatting date fields as ISO strings.", "scope": "", "scopeKind": ""}, {"name": "isNonEmptyString(value)", "description": "Checks if a value is a non-empty string.", "scope": "", "scopeKind": ""}, {"name": "isOptionalIsoDateString(value)", "description": "Validates whether a value is an optional ISO date string.", "scope": "", "scopeKind": ""}, {"name": "parseIsoDate(value)", "description": "Parses an ISO date string into a Date object if valid.", "scope": "", "scopeKind": ""}, {"name": "validateAnnouncement(candidate, isPatch)", "description": "Validates announcement object fields for correctness and constraints.", "scope": "", "scopeKind": ""}, {"name": "createAnnouncement(announcement)", "description": "Creates and stores a new announcement record after validation.", "scope": "", "scopeKind": ""}, {"name": "listAnnouncements()", "description": "Retrieves all stored announcements.", "scope": "", "scopeKind": ""}, {"name": "getAnnouncementById(id)", "description": "Retrieves a specific announcement by id.", "scope": "", "scopeKind": ""}, {"name": "replaceAnnouncement(id, replacement)", "description": "Replaces an existing announcement by id, preserving 'createdAt'.", "scope": "", "scopeKind": ""}, {"name": "patchAnnouncement(id, patch)", "description": "Partially updates an existing announcement record.", "scope": "", "scopeKind": ""}, {"name": "deleteAnnouncement(id)", "description": "Deletes an announcement by id.", "scope": "", "scopeKind": ""}, {"name": "clearAll()", "description": "Removes all announcements from the store.", "scope": "", "scopeKind": ""}], "calls": ["Announcement.create", "Announcement.find", "Announcement.findOne", "Announcement.findOneAndUpdate", "Announcement.deleteOne", "Announcement.deleteMany", "mapMongoError"], "search-terms": ["announcement management", "announcement validation", "MongoDB announcement", "announcement API", "Announcement model usage", "announcement store functions"], "state": 2, "file_id": 39, "knowledge_revision": 237, "git_revision": "ce6bcc1703ec7244471cf5453c23a3fa20df126a", "revision_history": [{"154": "06c72ee76f430f86574804c4a36529ec57b00899"}, {"219": "70692f10e6093a6b89251d9427a5d19e2bbbdf73"}, {"237": "ce6bcc1703ec7244471cf5453c23a3fa20df126a"}], "ctags": [{"_type": "tag", "name": "ALLOWED_PRIORITIES", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^  ALLOWED_PRIORITIES,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "ALLOWED_PRIORITIES", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^const ALLOWED_PRIORITIES = new Set(['low', 'normal', 'high']);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "Announcement", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^const Announcement = require('..\\/db\\/models\\/Announcement');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "clearAll", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^async function clearAll() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "createAnnouncement", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^async function createAnnouncement(announcement) {$/", "language": "JavaScript", "kind": "function", "signature": "(announcement)"}, {"_type": "tag", "name": "deleteAnnouncement", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^async function deleteAnnouncement(id) {$/", "language": "JavaScript", "kind": "function", "signature": "(id)"}, {"_type": "tag", "name": "getAnnouncementById", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^async function getAnnouncementById(id) {$/", "language": "JavaScript", "kind": "function", "signature": "(id)"}, {"_type": "tag", "name": "isNonEmptyString", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^function isNonEmptyString(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "isOptionalIsoDateString", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^function isOptionalIsoDateString(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "listAnnouncements", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^async function listAnnouncements() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "normalizeForApi", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^function normalizeForApi(announcement) {$/", "language": "JavaScript", "kind": "function", "signature": "(announcement)"}, {"_type": "tag", "name": "parseIsoDate", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^function parseIsoDate(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "patchAnnouncement", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^async function patchAnnouncement(id, patch) {$/", "language": "JavaScript", "kind": "function", "signature": "(id, patch)"}, {"_type": "tag", "name": "replaceAnnouncement", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^async function replaceAnnouncement(id, replacement) {$/", "language": "JavaScript", "kind": "function", "signature": "(id, replacement)"}, {"_type": "tag", "name": "validateAnnouncement", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/services/announcementsStore.js", "pattern": "/^function validateAnnouncement(candidate, isPatch) {$/", "language": "JavaScript", "kind": "function", "signature": "(candidate, isPatch)"}], "hash": "8183524b97bae7accd1edb6a0a9de88d", "format-version": 4, "code-base-name": "api_backend", "filename": "api_backend/src/services/announcementsStore.js", "fields": [{"name": "ALLOWED_PRIORITIES,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}]}