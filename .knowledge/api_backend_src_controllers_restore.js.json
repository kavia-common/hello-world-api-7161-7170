{"is_source_file": true, "format": "JavaScript", "description": "This file defines a controller for the restore endpoint in a Node.js Express application. It handles restoring application state from a snapshot, including validation, parsing, clearing stores, and replaying data creation operations. The file references several store modules for different resource types like employees, skill factories, learning paths, assessments, instructions, and announcements.", "external_files": ["../services/backupsFileStore", "../services/employeesStore", "../services/skillFactoriesStore", "../services/learningPathsStore", "../services/assessmentsStore", "../services/instructionsStore", "../services/announcementsStore"], "external_methods": ["backupsFileStore.readSnapshot", "employeesStore.clearAll", "employeesStore.createEmployee", "skillFactoriesStore.clearAll", "skillFactoriesStore.createSkillFactory", "learningPathsStore.clearAll", "learningPathsStore.createLearningPath", "assessmentsStore.clearAll", "assessmentsStore.createAssessment", "instructionsStore.clearAll", "instructionsStore.createInstruction", "announcementsStore.clearAll", "announcementsStore.createAnnouncement"], "published": ["restore"], "classes": [], "methods": [{"name": "isPlainObject(value)", "description": "Checks if a value is a plain object (not null, not array).", "scope": "", "scopeKind": ""}, {"name": "asArrayOrEmpty(value)", "description": "Converts a list-like value into an array, or returns an empty array if null or undefined.", "scope": "", "scopeKind": ""}, {"name": "emptySummary()", "description": "Creates a summary object with counters for attempted, restored, and failed items per resource.", "scope": "", "scopeKind": ""}, {"name": "clearAllStores()", "description": "Clears all in-memory data stores for resources.", "scope": "", "scopeKind": ""}, {"name": "resolveSnapshotFromRequest(body)", "description": "Validates and resolves the snapshot provided in the request body, loading from disk if necessary.", "scope": "", "scopeKind": ""}, {"name": "extractCollections(snapshot)", "description": "Extracts resource collections from a snapshot object, supporting multiple formats.", "scope": "", "scopeKind": ""}, {"name": "replayCreates(collections)", "description": "Restores resource collections into the stores by invoking create methods, tracking success and errors.", "scope": "", "scopeKind": ""}, {"name": "restore(req, res)", "description": "Main handler for the POST /restore endpoint, orchestrating the restore process based on input parameters and mode.", "scope": "", "scopeKind": ""}, {"name": "restoreList(resource, list, createFn)", "scope": "replayCreates", "scopeKind": "function", "description": "unavailable"}], "calls": ["resolveSnapshotFromRequest", "extractCollections", "clearAllStores", "replayCreates"], "search-terms": ["restore", "snapshot", "restoreSnapshot", "restoreMode", "in-memory stores", "resource collections", "resource restore", "resource import"], "state": 2, "file_id": 47, "knowledge_revision": 214, "git_revision": "70692f10e6093a6b89251d9427a5d19e2bbbdf73", "ctags": [{"_type": "tag", "name": "announcements", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    announcements: asArrayOrEmpty(source.announcements),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "announcementsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const announcementsStore = require('..\\/services\\/announcementsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "asArrayOrEmpty", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function asArrayOrEmpty(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "assessments", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    assessments: asArrayOrEmpty(source.assessments),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "assessmentsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const assessmentsStore = require('..\\/services\\/assessmentsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "backupsFileStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const backupsFileStore = require('..\\/services\\/backupsFileStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "clearAllStores", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function clearAllStores() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "collections", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^  const collections = {$/", "language": "JavaScript", "kind": "class", "scope": "extractCollections", "scopeKind": "class"}, {"_type": "tag", "name": "employees", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    employees: asArrayOrEmpty(source.employees),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "employeesStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const employeesStore = require('..\\/services\\/employeesStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "emptySummary", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function emptySummary() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "extractCollections", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function extractCollections(snapshot) {$/", "language": "JavaScript", "kind": "function", "signature": "(snapshot)"}, {"_type": "tag", "name": "instructions", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    instructions: asArrayOrEmpty(source.instructions),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "instructionsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const instructionsStore = require('..\\/services\\/instructionsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "isPlainObject", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function isPlainObject(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "learningPaths", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    learningPaths: asArrayOrEmpty(source.learningPaths),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "learningPathsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const learningPathsStore = require('..\\/services\\/learningPathsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "replayCreates", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function replayCreates(collections) {$/", "language": "JavaScript", "kind": "function", "signature": "(collections)"}, {"_type": "tag", "name": "resolveSnapshotFromRequest", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function resolveSnapshotFromRequest(body) {$/", "language": "JavaScript", "kind": "function", "signature": "(body)"}, {"_type": "tag", "name": "restore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^  restore,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "restore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function restore(req, res) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, res)"}, {"_type": "tag", "name": "restoreList", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^  async function restoreList(resource, list, createFn) {$/", "language": "JavaScript", "kind": "function", "signature": "(resource, list, createFn)", "scope": "replayCreates", "scopeKind": "function"}, {"_type": "tag", "name": "skillFactories", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    skillFactories: asArrayOrEmpty(source.skillFactories),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "skillFactoriesStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const skillFactoriesStore = require('..\\/services\\/skillFactoriesStore');$/", "language": "JavaScript", "kind": "constant"}], "hash": "a9497e4a3d0352465425ad1dfd3c8f5f", "format-version": 4, "code-base-name": "api_backend", "filename": "api_backend/src/controllers/restore.js", "fields": [{"name": "announcements: asArrayOrEmpty(source.announcements),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "assessments: asArrayOrEmpty(source.assessments),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "employees: asArrayOrEmpty(source.employees),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "instructions: asArrayOrEmpty(source.instructions),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "learningPaths: asArrayOrEmpty(source.learningPaths),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "restore,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "skillFactories: asArrayOrEmpty(source.skillFactories),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"214": "70692f10e6093a6b89251d9427a5d19e2bbbdf73"}]}