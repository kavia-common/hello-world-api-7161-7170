{"is_source_file": true, "format": "JavaScript", "description": "This file is a Node.js controller module handling the restoration of application state from a backup snapshot. It includes functions for validating input, extracting resource collections, and restoring data into various in-memory stores, with support for replacing or merging data. It also manages error handling and validation logic for the restore process.", "external_files": ["../services/backupsFileStore", "../services/employeesStore", "../services/skillFactoriesStore", "../services/learningPathsStore", "../services/assessmentsStore", "../services/instructionsStore", "../services/announcementsStore"], "external_methods": ["employeesStore.clearAll", "skillFactoriesStore.clearAll", "learningPathsStore.clearAll", "assessmentsStore.clearAll", "instructionsStore.clearAll", "announcementsStore.clearAll", "backupsFileStore.readSnapshot", "employeesStore.createEmployee", "skillFactoriesStore.createSkillFactory", "learningPathsStore.createLearningPath", "assessmentsStore.createAssessment", "instructionsStore.createInstruction", "announcementsStore.createAnnouncement"], "published": ["restore"], "classes": [], "methods": [{"name": "isPlainObject(value)", "description": "Determines if a value is a plain JavaScript object (not null, not an array).", "scope": "", "scopeKind": ""}, {"name": "asArrayOrEmpty(value)", "description": "Converts a value to an array if it isn't already one; returns an empty array if input is missing or not an array.", "scope": "", "scopeKind": ""}, {"name": "emptySummary()", "description": "Creates a standardized summary object to track attempted, restored, and failed counts for each resource type.", "scope": "", "scopeKind": ""}, {"name": "clearAllStores()", "description": "Clears all resource collections in the database by calling their respective clearAll() methods.", "scope": "", "scopeKind": ""}, {"name": "resolveSnapshotFromRequest(body)", "description": "Validates and resolves the snapshot input from request body, either by loading from disk or using a provided object.", "scope": "", "scopeKind": ""}, {"name": "extractCollections(snapshot)", "description": "Extracts resource collections like employees, skillFactories, etc., from a snapshot object, issuing warnings if no known sections are found.", "scope": "", "scopeKind": ""}, {"name": "replayCreates(collections)", "description": "Restores resource collections by invoking create methods, tracking success and errors.", "scope": "", "scopeKind": ""}, {"name": "restore(req, res)", "description": "Main function to handle restore requests, validating input, handling modes (replace/merge), and returning operation summaries.", "scope": "", "scopeKind": ""}, {"name": "restoreList(resource, list, createFn)", "scope": "replayCreates", "scopeKind": "function", "description": "unavailable"}], "calls": ["Promise.all", "employeesStore.clearAll", "skillFactoriesStore.clearAll", "learningPathsStore.clearAll", "assessmentsStore.clearAll", "instructionsStore.clearAll", "announcementsStore.clearAll", "backupsFileStore.readSnapshot", "employeesStore.createEmployee", "skillFactoriesStore.createSkillFactory", "learningPathsStore.createLearningPath", "assessmentsStore.createAssessment", "instructionsStore.createInstruction", "announcementsStore.createAnnouncement"], "search-terms": ["restoreController", "snapshotValidation", "resourceCollectionExtraction", "restoreProcess", "modeReplaceMerge", "snapshotLoading", "resourceStores", "backupFormat"], "state": 2, "file_id": 47, "knowledge_revision": 238, "git_revision": "ce6bcc1703ec7244471cf5453c23a3fa20df126a", "revision_history": [{"214": "70692f10e6093a6b89251d9427a5d19e2bbbdf73"}, {"238": "ce6bcc1703ec7244471cf5453c23a3fa20df126a"}], "ctags": [{"_type": "tag", "name": "announcements", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    announcements: asArrayOrEmpty(source.announcements),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "announcementsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const announcementsStore = require('..\\/services\\/announcementsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "asArrayOrEmpty", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function asArrayOrEmpty(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "assessments", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    assessments: asArrayOrEmpty(source.assessments),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "assessmentsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const assessmentsStore = require('..\\/services\\/assessmentsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "backupsFileStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const backupsFileStore = require('..\\/services\\/backupsFileStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "clearAllStores", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function clearAllStores() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "collections", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^  const collections = {$/", "language": "JavaScript", "kind": "class", "scope": "extractCollections", "scopeKind": "class"}, {"_type": "tag", "name": "employees", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    employees: asArrayOrEmpty(source.employees),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "employeesStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const employeesStore = require('..\\/services\\/employeesStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "emptySummary", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function emptySummary() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "extractCollections", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function extractCollections(snapshot) {$/", "language": "JavaScript", "kind": "function", "signature": "(snapshot)"}, {"_type": "tag", "name": "instructions", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    instructions: asArrayOrEmpty(source.instructions),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "instructionsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const instructionsStore = require('..\\/services\\/instructionsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "isPlainObject", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^function isPlainObject(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "learningPaths", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    learningPaths: asArrayOrEmpty(source.learningPaths),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "learningPathsStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const learningPathsStore = require('..\\/services\\/learningPathsStore');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "replayCreates", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function replayCreates(collections) {$/", "language": "JavaScript", "kind": "function", "signature": "(collections)"}, {"_type": "tag", "name": "resolveSnapshotFromRequest", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function resolveSnapshotFromRequest(body) {$/", "language": "JavaScript", "kind": "function", "signature": "(body)"}, {"_type": "tag", "name": "restore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^  restore,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "restore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^async function restore(req, res) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, res)"}, {"_type": "tag", "name": "restoreList", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^  async function restoreList(resource, list, createFn) {$/", "language": "JavaScript", "kind": "function", "signature": "(resource, list, createFn)", "scope": "replayCreates", "scopeKind": "function"}, {"_type": "tag", "name": "skillFactories", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^    skillFactories: asArrayOrEmpty(source.skillFactories),$/", "language": "JavaScript", "kind": "property", "scope": "extractCollections.collections", "scopeKind": "class"}, {"_type": "tag", "name": "skillFactoriesStore", "path": "/home/kavia/workspace/code-generation/hello-world-api-7161-7170/api_backend/src/controllers/restore.js", "pattern": "/^const skillFactoriesStore = require('..\\/services\\/skillFactoriesStore');$/", "language": "JavaScript", "kind": "constant"}], "hash": "8e99fe7ddcf6f9e2c9e64436976e9872", "format-version": 4, "code-base-name": "api_backend", "filename": "api_backend/src/controllers/restore.js", "fields": [{"name": "announcements: asArrayOrEmpty(source.announcements),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "assessments: asArrayOrEmpty(source.assessments),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "employees: asArrayOrEmpty(source.employees),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "instructions: asArrayOrEmpty(source.instructions),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "learningPaths: asArrayOrEmpty(source.learningPaths),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}, {"name": "restore,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "skillFactories: asArrayOrEmpty(source.skillFactories),", "scope": "extractCollections.collections", "scopeKind": "class", "description": "unavailable"}]}